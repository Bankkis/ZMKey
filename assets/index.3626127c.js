var v=Object.defineProperty,L=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var g=(s,t,i)=>t in s?v(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,c=(s,t)=>{for(var i in t||(t={}))x.call(t,i)&&g(s,i,t[i]);if(y)for(var i of y(t))z.call(t,i)&&g(s,i,t[i]);return s},f=(s,t)=>L(s,K(t));var a=(s,t,i)=>(g(s,typeof t!="symbol"?t+"":t,i),i);import{c as D,u as F,n as R,G as A,R as B,C as P,A as I}from"./vendor.8fe83a52.js";const O=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}};O();const N={layout:[],selectedKey:null},u=D(()=>{u.set(N)});function M(s){F(u,t=>f(c({},t),{selectedKey:s}))}const w={selectKey:M},T={layout:u};class C{constructor(t){a(this,"id",R());a(this,"_graphics",new A);a(this,"_subscriptions",[]);a(this,"_app");a(this,"_appSettings");a(this,"_position");a(this,"_secondaryPosition");a(this,"_size");a(this,"_secondarySize");this._app=t.app,this._appSettings=t.appSettings,this._position=t.position,this._size=t.size,this._secondaryPosition=t.secondaryPosition,this._secondarySize=t.secondarySize,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return c({},this._position)}get x(){return this._position.x}get y(){return this._position.y}get size(){return c({},this._size)}get width(){return this._size.width}get height(){return this._size.height}moveBy(t){this._graphics.x+=t.x,this._graphics.y+=t.y}_initSubscriptions(){var t;this._subscriptions.push((t=this._app.state)==null?void 0:t.layout.listen(()=>this._draw()))}_onClick(t){w.selectKey(this.id),t.stopPropagation()}_draw(){var _,h;const t=this._appSettings.unitSize,i=this._appSettings.keyCapCornerRadius,o=((h=(_=this._app.state)==null?void 0:_.layout.value)==null?void 0:h.selectedKey)===this.id,e=this._position.x*t,n=this._position.y*t,r=this._size.width*t-1,l=this._size.height*t-1;this._graphics.clear(),this._graphics.zIndex=o?100:1,this._graphics.lineStyle({width:1,color:o?15026179:0}),this._graphics.beginFill(13421772),this._graphics.drawRoundedRect(e,n,r,l,i*t),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:12040119}),this._graphics.beginFill(16579836),this._graphics.drawRoundedRect(e+t*.1,n+t*.07,r-t*.2,l-t*.2,i*t*.8),this._graphics.endFill()}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const t of this._subscriptions)t==null||t()}appendTo(t){return t.addChild(this._graphics),this}}class Y{constructor(t,i){a(this,"_container",new P);a(this,"_layoutOffset",{x:1,y:1});a(this,"_keyCaps",[]);a(this,"_kleFileInput");a(this,"_fileReader",new FileReader);a(this,"_dragging",!1);a(this,"_draggingData");this._app=t,this._appSettings=i,this._container.hitArea=new B(0,0,t.view.width,t.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._kleFileInput=document.getElementById("layout-editor__load-kle-input"),this._handleAddButtonClick=this._handleAddButtonClick.bind(this),this._handleContainerClick=this._handleContainerClick.bind(this),this._handleLoadKLEClick=this._handleLoadKLEClick.bind(this),this._handleKLEFileChange=this._handleKLEFileChange.bind(this),this._parseKLEFile=this._parseKLEFile.bind(this),this._handleDragStart=this._handleDragStart.bind(this),this._handleDragEnd=this._handleDragEnd.bind(this),this._handleDragMove=this._handleDragMove.bind(this),this._initSubscriptions()}_initSubscriptions(){var t,i;(t=document.getElementById("layout-editor__add-key"))==null||t.addEventListener("click",this._handleAddButtonClick),(i=document.getElementById("layout-editor__load-kle"))==null||i.addEventListener("click",this._handleLoadKLEClick),this._kleFileInput.addEventListener("change",this._handleKLEFileChange),this._container.on("pointerdown",this._handleContainerClick),this._container.on("pointerdown",this._handleDragStart).on("pointerup",this._handleDragEnd).on("pointerupoutside",this._handleDragEnd).on("pointermove",this._handleDragMove)}_handleAddButtonClick(){let t;if(this._keyCaps.length){const i=this._keyCaps[this._keyCaps.length-1],o=i.position.x>=15?this._layoutOffset.x:i.position.x+i.size.width,e=i.position.x>=15?i.position.y+i.size.height:i.position.y;t={x:o,y:e}}else t=c({},this._layoutOffset);this._keyCaps.push(new C({app:this._app,appSettings:this._appSettings,position:t,size:{width:1,height:1}}).appendTo(this._container))}_handleContainerClick(){var t,i;((i=(t=this._app.state)==null?void 0:t.layout.value)==null?void 0:i.selectedKey)&&w.selectKey(null)}_handleLoadKLEClick(){this._kleFileInput.click()}_handleKLEFileChange(t){var e;const o=(e=t.target.files)==null?void 0:e[0];o&&(this._fileReader.onload=this._parseKLEFile,this._fileReader.readAsText(o))}_parseKLEFile(t){var o,e;const i=t.target;if(i.result){const n=JSON.parse(i.result);let r,l=0;for(const _ of n){r=null;for(const h of _)if(typeof h=="object"){const S=(o=h.x)!=null?o:r?r.x+r.width:0,m=(e=h.y)!=null?e:l,E={x:S,y:m},b={width:h.w||h.w2||1,height:h.h||h.h2||1};r=new C({app:this._app,appSettings:this._appSettings,position:E,size:b}),this._keyCaps.push(r.appendTo(this._container))}++l}}}_handleDragStart(t){this._draggingData=t.data.getLocalPosition(this._container.parent),this._dragging=!0}_handleDragEnd(){this._dragging=!1,this._draggingData=void 0,this._container.cursor="default"}_handleDragMove(t){if(this._dragging&&this._draggingData){this._container.cursor="grabbing";const i=t.data.getLocalPosition(this._container.parent),o=i.x-this._draggingData.x,e=i.y-this._draggingData.y;for(const n of this._keyCaps)n.moveBy({x:o,y:e});this._draggingData=i}}}const d=document.getElementById("pixi-container"),p=new I({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,width:d==null?void 0:d.clientWidth,height:d==null?void 0:d.clientHeight});p.state=T;p.stage.sortableChildren=!0;const X={unitSize:70,keyCapCornerRadius:.1};var k;if(d){const s=document.getElementsByTagName("canvas");for(const t of Array.from(s))(k=t.parentNode)==null||k.removeChild(t)}d==null||d.appendChild(p.view);new Y(p,X);
