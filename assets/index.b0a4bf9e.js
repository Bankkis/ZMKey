var b=Object.defineProperty,S=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var p=(e,t,i)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,a=(e,t)=>{for(var i in t||(t={}))v.call(t,i)&&p(e,i,t[i]);if(y)for(var i of y(t))x.call(t,i)&&p(e,i,t[i]);return e},w=(e,t)=>S(e,m(t));var n=(e,t,i)=>(p(e,typeof t!="symbol"?t+"":t,i),i);import{c as k,u as z,G as f,a as R,T as K,n as B,R as O,C as A,A as F}from"./vendor.3a18ca44.js";const L=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))h(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function h(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}};L();const T={layout:[],selectedKey:null},l=k(()=>{l.set(T)});function I(e){z(l,t=>w(a({},t),{selectedKey:e}))}const C={selectKey:I},M={layout:l},P={position:{x:0,y:0},padding:0,borderWidth:0,borderColor:0,backgroundColor:15724527,hoverBackgroundColor:14540253,text:""};class E{constructor(t){n(this,"_graphics",new f);n(this,"_options");n(this,"_emitter",R());n(this,"_hover",!1);this._options=a(a({},P),t),this._graphics.interactive=!0,this._graphics.cursor="pointer",this._draw(),this._initSubscriptions()}_initSubscriptions(){this._graphics.on("pointerover",()=>{this._hover=!0,this._draw()}).on("pointerout",()=>{this._hover=!1,this._draw()}).on("pointerdown",()=>{this._emitter.emit("click")})}appendTo(t){return t.addChild(this._graphics),this}_draw(){this._graphics.clear(),this._graphics.removeChildren();const t=new K(this._options.text),i=this._options.radius?this._options.radius+this._options.padding:Math.max(t.width,t.height)/2+this._options.padding;t.x=this._options.position.x+Math.round(i*2-t.width)/2,t.y=this._options.position.y+Math.round(i*2-t.height)/2,this._graphics.addChild(t),this._graphics.lineStyle(this._options.borderWidth,this._options.borderColor),this._graphics.beginFill(this._hover?this._options.hoverBackgroundColor:this._options.backgroundColor),this._graphics.drawCircle(this._options.position.x+i,this._options.position.y+i,i),this._graphics.endFill()}on(t,i){return this._emitter.on(t,i)}destroy(){this._graphics.destroy()}}class N{constructor(t,i,h,s){n(this,"id",B());n(this,"_graphics",new f);n(this,"_subscriptions",[]);this._app=t,this._appSettings=i,this._position=h,this._size=s,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return a({},this._position)}get size(){return a({},this._size)}_initSubscriptions(){var t;this._subscriptions.push((t=this._app.state)==null?void 0:t.layout.listen(()=>this._draw()))}_onClick(t){C.selectKey(this.id),t.stopPropagation()}_draw(){var u,g;const t=this._appSettings.unitSize,i=this._appSettings.keyCapCornerRadius,h=((g=(u=this._app.state)==null?void 0:u.layout.value)==null?void 0:g.selectedKey)===this.id,s=this._position.x*t,o=this._position.y*t,c=this._size.width*t-1,_=this._size.height*t-1;this._graphics.clear(),this._graphics.zIndex=h?100:1,this._graphics.lineStyle({width:1,color:h?15026179:0}),this._graphics.beginFill(13421772),this._graphics.drawRoundedRect(s,o,c,_,i*t),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:12040119}),this._graphics.beginFill(16579836),this._graphics.drawRoundedRect(s+t*.1,o+t*.07,c-t*.2,_-t*.2,i*t*.8),this._graphics.endFill()}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const t of this._subscriptions)t==null||t()}appendTo(t){return t.addChild(this._graphics),this}}class W{constructor(t,i){n(this,"_container",new A);n(this,"_layoutOffset",{x:1,y:1});n(this,"_keyCaps",[]);n(this,"_addButton");this._app=t,this._appSettings=i,this._container.hitArea=new O(0,0,t.view.width,t.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._initUI(),this._initSubscriptions()}_initUI(){this._addButton=new E({text:"+",position:{x:20,y:20}}).appendTo(this._container)}_initSubscriptions(){this._container.on("pointerdown",this._handleContainerClick.bind(this)),this._addButton.on("click",this._handleAddButtonClick.bind(this))}_handleAddButtonClick(){let t;if(this._keyCaps.length){const i=this._keyCaps[this._keyCaps.length-1];console.log(i.position,i.size);const h=i.position.x>=15?this._layoutOffset.x:i.position.x+i.size.width,s=i.position.x>=15?i.position.y+i.size.height:i.position.y;t={x:h,y:s}}else t=a({},this._layoutOffset);this._keyCaps.push(new N(this._app,this._appSettings,t,{width:1,height:1}).appendTo(this._container))}_handleContainerClick(){var t,i;((i=(t=this._app.state)==null?void 0:t.layout.value)==null?void 0:i.selectedKey)&&C.selectKey(null)}}const r=document.getElementById("pixi-container"),d=new F({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,width:r==null?void 0:r.clientWidth,height:r==null?void 0:r.clientHeight});d.state=M;d.stage.sortableChildren=!0;const G={unitSize:70,keyCapCornerRadius:.1};r&&(r.innerHTML="");r==null||r.appendChild(d.view);new W(d,G);
