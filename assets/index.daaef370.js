var m=Object.defineProperty,k=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var d=(s,t,i)=>t in s?m(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,c=(s,t)=>{for(var i in t||(t={}))b.call(t,i)&&d(s,i,t[i]);if(g)for(var i of g(t))v.call(t,i)&&d(s,i,t[i]);return s},f=(s,t)=>k(s,S(t));var a=(s,t,i)=>(d(s,typeof t!="symbol"?t+"":t,i),i);import{c as x,u as z,n as A,G as K,R,C as B,A as E}from"./vendor.8fe83a52.js";const L=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}};L();const O={layout:[],selectedKey:null},p=x(()=>{p.set(O)});function F(s){z(p,t=>f(c({},t),{selectedKey:s}))}const w={selectKey:F},I={layout:p};class N{constructor(t,i,r,e){a(this,"id",A());a(this,"_graphics",new K);a(this,"_subscriptions",[]);this._app=t,this._appSettings=i,this._position=r,this._size=e,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return c({},this._position)}get size(){return c({},this._size)}_initSubscriptions(){var t;this._subscriptions.push((t=this._app.state)==null?void 0:t.layout.listen(()=>this._draw()))}_onClick(t){w.selectKey(this.id),t.stopPropagation()}_draw(){var _,y;const t=this._appSettings.unitSize,i=this._appSettings.keyCapCornerRadius,r=((y=(_=this._app.state)==null?void 0:_.layout.value)==null?void 0:y.selectedKey)===this.id,e=this._position.x*t,n=this._position.y*t,h=this._size.width*t-1,u=this._size.height*t-1;this._graphics.clear(),this._graphics.zIndex=r?100:1,this._graphics.lineStyle({width:1,color:r?15026179:0}),this._graphics.beginFill(13421772),this._graphics.drawRoundedRect(e,n,h,u,i*t),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:12040119}),this._graphics.beginFill(16579836),this._graphics.drawRoundedRect(e+t*.1,n+t*.07,h-t*.2,u-t*.2,i*t*.8),this._graphics.endFill()}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const t of this._subscriptions)t==null||t()}appendTo(t){return t.addChild(this._graphics),this}}class P{constructor(t,i){a(this,"_container",new B);a(this,"_layoutOffset",{x:1,y:1});a(this,"_keyCaps",[]);this._app=t,this._appSettings=i,this._container.hitArea=new R(0,0,t.view.width,t.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._handleAddButtonClick=this._handleAddButtonClick.bind(this),this._handleContainerClick=this._handleContainerClick.bind(this),this._initSubscriptions()}_initSubscriptions(){var t,i;(t=document.getElementById("layout-editor__add-key"))==null||t.addEventListener("click",this._handleAddButtonClick),(i=document.getElementById("layout-editor__load-kle"))==null||i.addEventListener("click",this._handleAddButtonClick),this._container.on("pointerdown",this._handleContainerClick)}_handleAddButtonClick(){let t;if(this._keyCaps.length){const i=this._keyCaps[this._keyCaps.length-1],r=i.position.x>=15?this._layoutOffset.x:i.position.x+i.size.width,e=i.position.x>=15?i.position.y+i.size.height:i.position.y;t={x:r,y:e}}else t=c({},this._layoutOffset);this._keyCaps.push(new N(this._app,this._appSettings,t,{width:1,height:1}).appendTo(this._container))}_handleContainerClick(){var t,i;((i=(t=this._app.state)==null?void 0:t.layout.value)==null?void 0:i.selectedKey)&&w.selectKey(null)}}const o=document.getElementById("pixi-container"),l=new E({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,width:o==null?void 0:o.clientWidth,height:o==null?void 0:o.clientHeight});l.state=I;l.stage.sortableChildren=!0;const T={unitSize:70,keyCapCornerRadius:.1};var C;if(o){const s=document.getElementsByTagName("canvas");for(const t of Array.from(s))(C=t.parentNode)==null||C.removeChild(t)}o==null||o.appendChild(l.view);new P(l,T);
