var S=Object.defineProperty,m=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var g=(n,t,i)=>t in n?S(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,c=(n,t)=>{for(var i in t||(t={}))b.call(t,i)&&g(n,i,t[i]);if(y)for(var i of y(t))L.call(t,i)&&g(n,i,t[i]);return n},f=(n,t)=>m(n,E(t));var o=(n,t,i)=>(g(n,typeof t!="symbol"?t+"":t,i),i);import{c as v,u as K,n as z,G as D,R as F,C as R,A}from"./vendor.8fe83a52.js";const B=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function i(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerpolicy&&(s.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?s.credentials="include":e.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(e){if(e.ep)return;e.ep=!0;const s=i(e);fetch(e.href,s)}};B();const P={layout:[],selectedKey:null},u=v(()=>{u.set(P)});function I(n){K(u,t=>f(c({},t),{selectedKey:n}))}const C={selectKey:I},O={layout:u};class w{constructor(t){o(this,"id",z());o(this,"_graphics",new D);o(this,"_subscriptions",[]);o(this,"_app");o(this,"_appSettings");o(this,"_position");o(this,"_secondaryPosition");o(this,"_size");o(this,"_secondarySize");this._app=t.app,this._appSettings=t.appSettings,this._position=t.position,this._size=t.size,this._secondaryPosition=t.secondaryPosition,this._secondarySize=t.secondarySize,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return c({},this._position)}get x(){return this._position.x}get y(){return this._position.y}get size(){return c({},this._size)}get width(){return this._size.width}get height(){return this._size.height}moveBy(t){this._graphics.x+=t.x,this._graphics.y+=t.y}_initSubscriptions(){var t;this._subscriptions.push((t=this._app.state)==null?void 0:t.layout.listen(()=>this._draw()))}_onClick(t){C.selectKey(this.id),t.stopPropagation()}_draw(){var l,_;const t=this._appSettings.unitSize,i=this._appSettings.keyCapCornerRadius,a=((_=(l=this._app.state)==null?void 0:l.layout.value)==null?void 0:_.selectedKey)===this.id,e=this._position.x*t,s=this._position.y*t,d=this._size.width*t-1,r=this._size.height*t-1;this._graphics.clear(),this._graphics.zIndex=a?100:1,this._graphics.lineStyle({width:1,color:a?15026179:0}),this._graphics.beginFill(13421772),this._graphics.drawRoundedRect(e,s,d,r,i*t),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:12040119}),this._graphics.beginFill(16579836),this._graphics.drawRoundedRect(e+t*.1,s+t*.07,d-t*.2,r-t*.2,i*t*.8),this._graphics.endFill()}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const t of this._subscriptions)t==null||t()}appendTo(t){return t.addChild(this._graphics),this}}class N{constructor(t,i){o(this,"_container",new R);o(this,"_layoutOffset",{x:1,y:1});o(this,"_keyCaps",[]);o(this,"_kleFileInput");o(this,"_fileReader",new FileReader);o(this,"_dragging",!1);o(this,"_draggingData");this._app=t,this._appSettings=i,this._container.hitArea=new F(0,0,t.view.width,t.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._kleFileInput=document.getElementById("layout-editor__load-kle-input"),this._handleAddButtonClick=this._handleAddButtonClick.bind(this),this._handleContainerClick=this._handleContainerClick.bind(this),this._handleLoadKLEClick=this._handleLoadKLEClick.bind(this),this._handleKLEFileChange=this._handleKLEFileChange.bind(this),this._parseKLEFile=this._parseKLEFile.bind(this),this._handleDragStart=this._handleDragStart.bind(this),this._handleDragEnd=this._handleDragEnd.bind(this),this._handleDragMove=this._handleDragMove.bind(this),this._initSubscriptions()}_initSubscriptions(){var t,i;(t=document.getElementById("layout-editor__add-key"))==null||t.addEventListener("click",this._handleAddButtonClick),(i=document.getElementById("layout-editor__load-kle"))==null||i.addEventListener("click",this._handleLoadKLEClick),this._kleFileInput.addEventListener("change",this._handleKLEFileChange),this._container.on("pointerdown",this._handleContainerClick),this._container.on("pointerdown",this._handleDragStart).on("pointerup",this._handleDragEnd).on("pointerupoutside",this._handleDragEnd).on("pointermove",this._handleDragMove)}_handleAddButtonClick(){let t;if(this._keyCaps.length){const i=this._keyCaps[this._keyCaps.length-1],a=i.position.x>=15?this._layoutOffset.x:i.position.x+i.size.width,e=i.position.x>=15?i.position.y+i.size.height:i.position.y;t={x:a,y:e}}else t=c({},this._layoutOffset);this._keyCaps.push(new w({app:this._app,appSettings:this._appSettings,position:t,size:{width:1,height:1}}).appendTo(this._container))}_handleContainerClick(){var t,i;((i=(t=this._app.state)==null?void 0:t.layout.value)==null?void 0:i.selectedKey)&&C.selectKey(null)}_handleLoadKLEClick(){this._kleFileInput.click()}_handleKLEFileChange(t){var e;const a=(e=t.target.files)==null?void 0:e[0];a&&(this._fileReader.onload=this._parseKLEFile,this._fileReader.readAsText(a))}_parseKLEFile(t){const i=t.target;if(i.result){const a=JSON.parse(i.result),e={x:0,y:0,rx:0,ry:0,h:1,w:1},s={x:0,y:0};for(const d of a){for(const r of d)if(typeof r=="object")"rx"in r&&(e.rx=s.x=r.rx,e.x=s.x,e.y=s.y),"ry"in r&&(e.ry=s.y=r.ry,e.x=s.x,e.y=s.y),r.x&&(e.x+=r.x),r.y&&(e.y+=r.y);else{const l={x:e.x,y:e.y};console.log(l);const _={width:e.w,height:e.h},x=new w({app:this._app,appSettings:this._appSettings,position:l,size:_});this._keyCaps.push(x.appendTo(this._container))}++e.y,e.x=e.rx}}}_handleDragStart(t){this._draggingData=t.data.getLocalPosition(this._container.parent),this._dragging=!0}_handleDragEnd(){this._dragging=!1,this._draggingData=void 0,this._container.cursor="default"}_handleDragMove(t){if(this._dragging&&this._draggingData){this._container.cursor="grabbing";const i=t.data.getLocalPosition(this._container.parent),a=i.x-this._draggingData.x,e=i.y-this._draggingData.y;for(const s of this._keyCaps)s.moveBy({x:a,y:e});this._draggingData=i}}}const h=document.getElementById("pixi-container"),p=new A({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,width:h==null?void 0:h.clientWidth,height:h==null?void 0:h.clientHeight});p.state=O;p.stage.sortableChildren=!0;const M={unitSize:70,keyCapCornerRadius:.1};var k;if(h){const n=document.getElementsByTagName("canvas");for(const t of Array.from(n))(k=t.parentNode)==null||k.removeChild(t)}h==null||h.appendChild(p.view);new N(p,M);
