var D=Object.defineProperty,K=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var g=(h,i,t)=>i in h?D(h,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[i]=t,_=(h,i)=>{for(var t in i||(i={}))F.call(i,t)&&g(h,t,i[t]);if(v)for(var t of v(i))I.call(i,t)&&g(h,t,i[t]);return h},u=(h,i)=>K(h,z(i));var o=(h,i,t)=>(g(h,typeof i!="symbol"?i+"":i,t),t);import{c as P,u as O,n as R,G as x,R as A,C as B,A as G,P as N}from"./vendor.1ea05947.js";const T=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}};T();const M={layout:[],selectedKey:null},y=P(()=>{y.set(M)});function X(h){O(y,i=>u(_({},i),{selectedKey:h}))}const C={selectKey:X},H={layout:y};class S{constructor(i,t){o(this,"id",R());o(this,"_graphics",new x);o(this,"_pivotGraphics",new x);o(this,"_subscriptions",[]);o(this,"_app");o(this,"_appSettings");o(this,"_position");o(this,"_secondaryPosition");o(this,"_size");o(this,"_secondarySize");o(this,"_pivot");o(this,"_angle");this.customData=t,this._app=i.app,this._appSettings=i.appSettings,this._position=i.position,this._size=i.size,this._secondaryPosition=i.secondaryPosition,this._secondarySize=i.secondarySize,this._pivot=i.pivot,this._angle=i.angle,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return _({},this._position)}get x(){return this._position.x}get y(){return this._position.y}get size(){return _({},this._size)}get width(){return this._size.width}get height(){return this._size.height}moveBy(i){this._graphics.x+=i.x,this._graphics.y+=i.y}_initSubscriptions(){var i;this._subscriptions.push((i=this._app.state)==null?void 0:i.layout.listen(()=>this._draw()))}_onClick(i){C.selectKey(this.id),this.customData&&console.log(this.customData,this),i.stopPropagation()}_draw(){var d,e;const i=this._appSettings.unitSize,t=this._appSettings.keyCapCornerRadius,r=((e=(d=this._app.state)==null?void 0:d.layout.value)==null?void 0:e.selectedKey)===this.id;this._graphics.pivot.set((this._pivot.x-this._position.x)*i,(this._pivot.y-this._position.y)*i),this._graphics.position.x=this._position.x*i+this._graphics.pivot.x,this._graphics.position.y=this._position.y*i+this._graphics.pivot.y;const s=this._size.width*i-1,a=this._size.height*i-1;this._pivotGraphics.clear(),this._graphics.clear(),this._pivotGraphics.zIndex=this._graphics.zIndex=r?100:1,this._pivotGraphics.beginFill(16711680),this._pivotGraphics.position.set(this._pivot.x*i,this._pivot.y*i),this._pivotGraphics.drawCircle(0,0,5),this._pivotGraphics.endFill(),this._pivotGraphics.visible=r,this._graphics.angle=this._angle,this._graphics.lineStyle({width:1,color:r?15026179:0}),this._graphics.beginFill(13421772),this._graphics.drawRoundedRect(0,0,s,a,t*i),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:12040119}),this._graphics.beginFill(16579836),this._graphics.drawRoundedRect(i*.1,i*.07,s-i*.2,a-i*.2,t*i*.8),this._graphics.endFill()}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const i of this._subscriptions)i==null||i()}appendTo(i){return i.addChild(this._graphics),i.addChild(this._pivotGraphics),this}}class j{constructor(i,t){o(this,"_container",new B);o(this,"_layoutOffset",{x:1,y:1});o(this,"_keyCaps",[]);o(this,"_kleFileInput");o(this,"_fileReader",new FileReader);o(this,"_dragging",!1);o(this,"_draggingData");this._app=i,this._appSettings=t,this._container.hitArea=new A(0,0,i.view.width,i.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._kleFileInput=document.getElementById("layout-editor__load-kle-input"),this._handleAddButtonClick=this._handleAddButtonClick.bind(this),this._handleContainerClick=this._handleContainerClick.bind(this),this._handleLoadKLEClick=this._handleLoadKLEClick.bind(this),this._handleKLEFileChange=this._handleKLEFileChange.bind(this),this._parseKLEFile=this._parseKLEFile.bind(this),this._handleDragStart=this._handleDragStart.bind(this),this._handleDragEnd=this._handleDragEnd.bind(this),this._handleDragMove=this._handleDragMove.bind(this),this._initSubscriptions()}_initSubscriptions(){var i,t;(i=document.getElementById("layout-editor__add-key"))==null||i.addEventListener("click",this._handleAddButtonClick),(t=document.getElementById("layout-editor__load-kle"))==null||t.addEventListener("click",this._handleLoadKLEClick),this._kleFileInput.addEventListener("change",this._handleKLEFileChange),this._container.on("pointerdown",this._handleContainerClick),this._container.on("pointerdown",this._handleDragStart).on("pointerup",this._handleDragEnd).on("pointerupoutside",this._handleDragEnd).on("pointermove",this._handleDragMove)}_handleAddButtonClick(){let i;if(this._keyCaps.length){const t=this._keyCaps[this._keyCaps.length-1],r=t.position.x>=15?this._layoutOffset.x:t.position.x+t.size.width,s=t.position.x>=15?t.position.y+t.size.height:t.position.y;i={x:r,y:s}}else i=_({},this._layoutOffset);this._keyCaps.push(new S({app:this._app,appSettings:this._appSettings,position:i,size:{width:1,height:1}}).appendTo(this._container))}_handleContainerClick(){var i,t;((t=(i=this._app.state)==null?void 0:i.layout.value)==null?void 0:t.selectedKey)&&C.selectKey(null)}_handleLoadKLEClick(){this._kleFileInput.click()}_handleKLEFileChange(i){var s;const r=(s=i.target.files)==null?void 0:s[0];r&&(this._fileReader.onload=this._parseKLEFile,this._fileReader.readAsText(r))}_parseKLEFile(i){var r,s,a;const t=i.target;if(t.result){const d=JSON.parse(t.result),e={x:0,y:0,rx:0,ry:0,h:1,w:1},c={x:0,y:0};for(const f of d)if(!!Array.isArray(f)){for(const n of f)if(typeof n=="object")"rx"in n&&(e.rx=c.x=n.rx,e.x=c.x,e.y=c.y),"ry"in n&&(e.ry=c.y=n.ry,e.x=c.x,e.y=c.y),n.x&&(e.x+=n.x),n.y&&(e.y+=n.y),"r"in n&&(e.r=n.r),"w"in n&&(e.w=n.w),"h"in n&&(e.h=n.h),"h2"in n&&!("h"in n)?e.h=n.h2:"h2"in n&&(e.h2=n.h2),"w2"in n&&!("w"in n)?e.w=n.w2:"w2"in n&&(e.w2=n.w2);else{const m={x:e.x,y:e.y},w={width:e.w||e.w2||1,height:e.h||e.h2||1},E={x:(r=e.rx)!=null?r:0,y:(s=e.ry)!=null?s:0},L=(a=e.r)!=null?a:0,b=new S({app:this._app,appSettings:this._appSettings,position:m,size:w,pivot:E,angle:L},u(_({},e),{key:n}));this._keyCaps.push(b.appendTo(this._container)),e.x+=w.width,e.w=e.h=1,e.x2=e.y2=e.w2=e.h2=0}++e.y,e.x=e.rx}}}_handleDragStart(i){this._draggingData=i.data.getLocalPosition(this._container.parent),this._dragging=!0}_handleDragEnd(){this._dragging=!1,this._draggingData=void 0,this._container.cursor="default"}_handleDragMove(i){if(this._dragging&&this._draggingData){this._container.cursor="grabbing";const t=i.data.getLocalPosition(this._container.parent),r=t.x-this._draggingData.x,s=t.y-this._draggingData.y;for(const a of this._keyCaps)a.moveBy({x:r,y:s});this._draggingData=t}}}const l=document.getElementById("pixi-container"),p=new G({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,autoDensity:!0,resizeTo:l,width:l==null?void 0:l.clientWidth,height:l==null?void 0:l.clientHeight});p.state=H;p.stage.sortableChildren=!0;const Y={unitSize:70,keyCapCornerRadius:.1};var k;if(l){const h=document.getElementsByTagName("canvas");for(const i of Array.from(h))(k=i.parentNode)==null||k.removeChild(i)}l==null||l.appendChild(p.view);window.__PIXI_INSPECTOR_GLOBAL_HOOK__&&window.__PIXI_INSPECTOR_GLOBAL_HOOK__.register({PIXI:N});new j(p,Y);
