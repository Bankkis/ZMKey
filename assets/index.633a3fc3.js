var C=Object.defineProperty,x=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var l=(s,t,i)=>t in s?C(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,a=(s,t)=>{for(var i in t||(t={}))m.call(t,i)&&l(s,i,t[i]);if(y)for(var i of y(t))k.call(t,i)&&l(s,i,t[i]);return s},f=(s,t)=>x(s,v(t));var n=(s,t,i)=>(l(s,typeof t!="symbol"?t+"":t,i),i);import{c as z,u as T,G as w,a as I,f as P,S as K,T as L,b as B,n as M,R,C as A,A as E}from"./vendor.2cfee026.js";const O=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))h(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const p of e.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&h(p)}).observe(document,{childList:!0,subtree:!0});function i(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerpolicy&&(e.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?e.credentials="include":o.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function h(o){if(o.ep)return;o.ep=!0;const e=i(o);fetch(o.href,e)}};O();const F={layout:[],selectedKey:null},_=z(()=>{_.set(F)});function H(s){T(_,t=>f(a({},t),{selectedKey:s}))}const S={selectKey:H},N={layout:_};function W(s){const t=document.createElement("template");return s=s.trim(),t.innerHTML=s,t.content.firstChild}const G={position:{x:0,y:0},padding:0,borderWidth:0,borderColor:0,backgroundColor:15724527,hoverBackgroundColor:14540253,iconSize:26,icon:"",tooltipSize:16};class b{constructor(t,i){n(this,"_graphics",new w);n(this,"_icon");n(this,"_tooltip");n(this,"_options");n(this,"_emitter",I());n(this,"_hover",!1);n(this,"_expandProgress",0);n(this,"_tooltipMargin",5);this._app=i,this._options=a(a({},G),t),this._graphics.interactive=!0,this._graphics.cursor="pointer",this._initIcon(),this._initTooltip(),this._draw(),this._initSubscriptions()}_initIcon(){const t=P.icons[this._options.icon];if(!t){console.warn(`Invalid icon name: ${this._options.icon}`);return}const i=W(t.toSvg());if(!i){console.warn(`Unable to parse icon content: ${this._options.icon}`);return}this._icon=new K(i,{}),this._graphics.addChild(this._icon),this._icon.height=this._icon.width=this._options.iconSize,this._icon.position.set(this._options.position.x+this._options.padding,this._options.position.y+this._options.padding)}_initTooltip(){if(this._options.tooltip){const t=new L({fontSize:this._options.tooltipSize});this._tooltip=new B(this._options.tooltip,t),this._graphics.addChild(this._tooltip),this._tooltip.visible=!1,this._tooltip.position.set(this._options.position.x+this._icon.width+this._tooltipMargin+this._options.padding,this._options.position.y+(this._icon.height-this._tooltip.height)/2+this._options.padding)}}_initSubscriptions(){this._graphics.on("pointerover",()=>{this._hover=!0,this._options.tooltip&&this._expandTooltip(),this._draw()}).on("pointerout",()=>{this._hover=!1,this._options.tooltip&&this._collapseTooltip(),this._draw()}).on("pointerdown",()=>{this._emitter.emit("click")})}_expandTooltip(){this._app||(this._expandProgress=1,this._tooltip&&(this._tooltip.visible=!0),this._draw())}_collapseTooltip(){this._app||(this._expandProgress=0,this._tooltip&&(this._tooltip.visible=!1),this._draw())}appendTo(t){return t.addChild(this._graphics),this}_draw(){var e;this._graphics.clear();const t=this._options.iconSize/2+this._options.padding,i=((e=this._tooltip)==null?void 0:e.width)||0;this._graphics.lineStyle(this._options.borderWidth,this._options.borderColor),this._graphics.beginFill(this._hover?this._options.hoverBackgroundColor:this._options.backgroundColor);const h={x:this._options.position.x+t,y:this._options.position.y+t},o={x:this._options.position.x+t+i*this._expandProgress+(this._tooltip.visible?this._tooltipMargin*2:0),y:this._options.position.y+t};this._graphics.arc(h.x,h.y,t,Math.PI/2,Math.PI*1.5),this._graphics.arc(o.x,o.y,t,Math.PI*1.5,Math.PI/2),this._graphics.endFill()}on(t,i){return this._emitter.on(t,i)}destroy(){this._graphics.destroy()}}class U{constructor(t,i,h,o){n(this,"id",M());n(this,"_graphics",new w);n(this,"_subscriptions",[]);this._app=t,this._appSettings=i,this._position=h,this._size=o,this._graphics.interactive=!0,this._graphics.cursor="pointer",this._graphics.on("pointerdown",this._onClick.bind(this)),this._initSubscriptions(),this._draw()}get position(){return a({},this._position)}get size(){return a({},this._size)}_initSubscriptions(){var t;this._subscriptions.push((t=this._app.state)==null?void 0:t.layout.listen(()=>this._draw()))}_onClick(t){S.selectKey(this.id),t.stopPropagation()}_draw(){var u,g;const t=this._appSettings.unitSize,i=this._appSettings.keyCapCornerRadius,h=((g=(u=this._app.state)==null?void 0:u.layout.value)==null?void 0:g.selectedKey)===this.id,o=this._position.x*t,e=this._position.y*t,p=this._size.width*t-1,d=this._size.height*t-1;this._graphics.clear(),this._graphics.zIndex=h?100:1,this._graphics.lineStyle({width:1,color:h?15026179:0}),this._graphics.beginFill(13421772),this._graphics.drawRoundedRect(o,e,p,d,i*t),this._graphics.endFill(),this._graphics.lineStyle({width:1,color:12040119}),this._graphics.beginFill(16579836),this._graphics.drawRoundedRect(o+t*.1,e+t*.07,p-t*.2,d-t*.2,i*t*.8),this._graphics.endFill()}destroy(){this._app.stage.removeChild(this._graphics),this._destroySubscriptions()}_destroySubscriptions(){for(const t of this._subscriptions)t==null||t()}appendTo(t){return t.addChild(this._graphics),this}}class ${constructor(t,i){n(this,"_container",new A);n(this,"_layoutOffset",{x:1,y:1});n(this,"_keyCaps",[]);n(this,"_addButton");n(this,"_uploadKLEButton");this._app=t,this._appSettings=i,this._container.hitArea=new R(0,0,t.view.width,t.view.height),this._container.interactive=!0,this._container.sortableChildren=!0,this._app.stage.addChild(this._container),this._initUI(),this._initSubscriptions()}_initUI(){this._addButton=new b({icon:"plus",tooltip:"Add Key",position:{x:20,y:20},padding:3}).appendTo(this._container),this._uploadKLEButton=new b({icon:"download",tooltip:"Load KLE layout",position:{x:20,y:60},iconSize:22,padding:5}).appendTo(this._container)}_initSubscriptions(){this._container.on("pointerdown",this._handleContainerClick.bind(this)),this._addButton.on("click",this._handleAddButtonClick.bind(this))}_handleAddButtonClick(){let t;if(this._keyCaps.length){const i=this._keyCaps[this._keyCaps.length-1],h=i.position.x>=15?this._layoutOffset.x:i.position.x+i.size.width,o=i.position.x>=15?i.position.y+i.size.height:i.position.y;t={x:h,y:o}}else t=a({},this._layoutOffset);this._keyCaps.push(new U(this._app,this._appSettings,t,{width:1,height:1}).appendTo(this._container))}_handleContainerClick(){var t,i;((i=(t=this._app.state)==null?void 0:t.layout.value)==null?void 0:i.selectedKey)&&S.selectKey(null)}}const r=document.getElementById("pixi-container"),c=new E({backgroundColor:16777215,resolution:window.devicePixelRatio,antialias:!0,width:r==null?void 0:r.clientWidth,height:r==null?void 0:r.clientHeight});c.state=N;c.stage.sortableChildren=!0;const j={unitSize:70,keyCapCornerRadius:.1};r&&(r.innerHTML="");r==null||r.appendChild(c.view);new $(c,j);
